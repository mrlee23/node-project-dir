<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>index.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-index-ProjectDir.html">ProjectDir</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#constructor">constructor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#get_basedir">get_basedir</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#get_basename">get_basename</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#get_wd">get_wd</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#parse">parse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#resolve">resolve</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#retrieve">retrieve</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#set_basedir">set_basedir</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#set_basename">set_basename</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index-ProjectDir.html#set_wd">set_wd</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-lib_path-Path.html">Path</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_path-Path.html#equal">equal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_path-Path.html#isParent">isParent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_path-Path.html#locateBase:">locateBase:</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_path-Path.html#toRoot">toRoot</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-index.html">index</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-lib_path.html">lib/path</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileOverview Manipulate project directories and files.
 * @name index.js
 * @author Dongsoo Lee &lt;mrlee_23@naver.com>
 * @copyright 2018 Dongsoo Lee &lt;mrlee_23@naver.com>
 * @module index
 * @version 0.1.1
 * @since 0.0.1
 * @created 2017-12-26
 *
 * @requires module:./lib/typeCheck.js
 * @requires module:./lib/path.js
 */
/**
 * For matching file name.
 * @typedef {string|RegExp|Array} Query
 */
/**
 * Represent file system path, include relative and absolute paths.
 * @typedef {string} Path
 */
/**
 * Absolute path of real file system.
 * @typedef {string} AbsPath
 */
/**
 * Represent managed path in project, include relative and absolute paths.
 * @typedef {string} ProjectPath
 */
/**
 * Represent managed absolute path in project.
 * @typedef {string} ProjectAbsPath
 */

const type = require('./lib/typeCheck.js'),
	  path = require('./lib/path.js');

/**
 * @class
 * @name ProjectDir
 * @classdesc project-dir main class
 * @version 0.1.1
 * @since 0.0.1
 * @created 2017-12-26
 */
class ProjectDir {
	/**
	 * @public
	 * @instance
	 * @function constructor
	 * @version 0.1.1
	 * @since 0.0.1
	 * @created 2017-12-26
	 * @memberof module:index~ProjectDir
	 * @description Generating new project directory object.
	 *
	 * @param {Path} currentPath - Starting point for search base directory. This path must be an existing file or directory.
	 * @param {Query} basename - Dominating file or directory names.
	 *
	 * @example
	 * .constructor('./', 'node_modules')
	 */
	constructor(currentPath, basename) {
		(basename == null) &amp;&amp; (this.basename = [".git", "package.json"]);
		this.basename = basename;
		this.basedir = currentPath;
	}

	/**
	 * @public
	 * @instance
	 * @function set_basename
	 * @version 0.1.1
	 * @since 0.0.1
	 * @created 2017-12-26
	 * @memberof module:index~ProjectDir
	 * @description Set dominating file or directory names.
	 *
	 * @param {Query} basename - Dominating file or directory names.
	 * @throws {Error} Not a Query type.
	 *
	 * @example
	 * .basename = ['.git', 'package.json']
	 */
	set basename (basename) {
		if (!type.isQuery(basename)) throw new Error(`basename(${basename}) is not a Query type.`);
		this._basename = basename;
	}

	/**
	 * @public
	 * @instance
	 * @function get_basename
	 * @version 0.1.1
	 * @since 0.0.1
	 * @created 2018-01-22
	 * @memberof module:index~ProjectDir
	 * @description Get basename of current project
	 *
	 * @returns {Path} Current basenames.
	 *
	 * @example
	 * .basename()
	 */
	get basename () { return this._basename; }

	/**
	 * @public
	 * @instance
	 * @function set_basedir
	 * @version 0.1.1
	 * @since 0.0.1
	 * @created 2017-12-26
	 * @memberof module:index~ProjectDir
	 * @description Set project's base directory.
	 *
	 * @param {Path} _path - Strting point for search base directory.
	 * @throws {Error} Failed searching base directory of project.
	 *
	 * @example
	 * .basedir = './'
	 */
	set basedir (_path) {
		_path = path.resolve(_path);
		type.isFile(_path) &amp;&amp; (_path = path.dirname(_path));
		if (!type.isDir(_path)) throw new Error(`_path(${_path}) does not exist directory.`);
		if (type.isRoot(_path)) throw new Error(`_path(${_path}) cannot be a root.`);
		let basedir;
		if (Array.isArray(this.basename)) {
			this.basename.some(name => {
				let tmpLoc = path.locateBase(_path, name);
				!type.isRoot(tmpLoc) &amp;&amp; (basedir = tmpLoc);
			});
		} else {
			basedir = path.locateBase(_path, this.basename);
		}
		if (type.isRoot(basedir) || basedir == null) throw new Error(`_path(${_path}) has no parent node name of basename(${this.basename})`);
		this._basedir = basedir;
		this.wd = this.retrieve(_path);
	}

	/**
	 * @public
	 * @instance
	 * @function get_basedir
	 * @version 0.1.1
	 * @since 0.0.1
	 * @created 2018-01-22
	 * @memberof module:index~ProjectDir
	 * @description Get base directory of current project.
	 *
	 * @returns {Path} Current base directory's absolute path.
	 *
	 * @example
	 * .basedir()
	 */
	get basedir () { return this._basedir; }

	/**
	 * @public
	 * @instance
	 * @function set_wd
	 * @version 0.1.1
	 * @since 0.0.1
	 * @created 2017-12-26
	 * @memberof module:index~ProjectDir
	 * @description Set working directory based on current project's base directory.
	 *
	 * @param {ProjectPath} _path - Sub path of base directory.
	 * @throws {Error} Out of range in root path.
	 *
	 * @example
	 * .wd = 'abcdef'
	 */
	set wd (_path) {
		let wd = this.resolve(_path);
		if (wd == null) throw new Error(`working directory path(${_path}) is out of range in root path.`);
		wd != null &amp;&amp; (this._workingDir = wd);
	}
	
	/**
	 * @public
	 * @instance
	 * @function get_wd
	 * @version 0.1.1
	 * @since 0.0.1
	 * @created 2018-01-22
	 * @memberof module:index~ProjectDir
	 * @description Get current working directory.
	 *
	 * @returns {Path} Current working directory's absolute path.
	 *
	 * @example
	 * .wd()
	 */
	get wd () { return this._workingDir || this.basedir; }

	/**
	 * @public
	 * @instance
	 * @function resolve
	 * @version 0.1.1
	 * @since 0.0.1
	 * @created 2017-12-26
	 * @memberof module:index~ProjectDir
	 * @description Resolving the path based on current project's base directory.
	 *
	 * @param {ProjectPath} _path - to resolve path.
	 * @throws {Error} _path is not a string type.
	 * @returns {null|Path} resolved path or null out of range in root path.
	 *
	 * @example
	 * .resolve('/abcd/efgh')
	 */
	resolve (_path) {
		if (typeof _path !== 'string') throw new Error(`_path(${_path}) is not a string type.`);
		if (path.isAbsolute(_path)) {
			_path = path.resolve(this.basedir, _path.substr(1));
		} else {
			_path = path.resolve(this.wd || this.basedir, _path);
		}

		// out of range in project directory.
		if (!path.equal(this.basedir, _path) &amp;&amp;
			!path.isParent(this.basedir, _path)) 
			return null;
		
		return _path;
	}

	/**
	 * @public
	 * @instance
	 * @function retrieve
	 * @version 0.1.1
	 * @since 0.1.1
	 * @created 2017-12-27
	 * @memberof module:index~ProjectDir
	 * @description Retrieve project path from absolute real path.
	 *
	 * @param {AbsPath} _path - absolute real path.
	 * @throws {Error} If not a string type, If not an absolute path.
	 * @returns {ProjectAbsPath} absolute project path.
	 *
	 * @example
	 * .retrieve(/home/user/abcd/efgh) // => /abcd/efgh (if /home/user is root)
	 */
	retrieve (_path) {
		if (typeof _path !== 'string') throw new Error(`_path(${_path}) is not a string type.`);
		if (!path.isAbsolute(_path)) throw new Error(`_path(${_path}) is not an absolute path.`);
		if (path.equal(this.basedir, _path)) return "/";
		if (!path.isParent(this.basedir, _path)) return null;
		let relPath = _path.substr(this.basedir.length);
		if (relPath[0] != '/') relPath = '/' + relPath;
		return relPath;
	}

	/**
	 * @public
	 * @instance
	 * @function parse
	 * @version 0.1.1
	 * @since 0.0.1
	 * @created 2017-12-26
	 * @memberof module:index~ProjectDir
	 * @description Parsing a path.
	 *
	 * @param {ProjectPath} _path - to parse path.
	 * @throws {Error} _path is not a string type.
	 * @returns {Object} parsed path's object.
	 *
	 * @example
	 * .parse('abcd')
	 */
	parse (_path) {
		if (typeof _path !== 'string') throw new Error(`_path(${_path}) is not a string type.`);
		let rPath = this.resolve(_path);
		let ret = {
			root: this.basedir,
			names: this.basename,
			wd: this.wd,
			path: path.relative(this.wd, rPath),
			abs: "/"+path.relative(this.basedir, path.resolve(this.wd, rPath)),
			realPath: path.resolve(this.wd, rPath)
		};
		return ret;
	}
}

module.exports = ProjectDir;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Jan 22 2018 11:22:03 GMT+0000 (UTC) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
